namespace Play.Services.Api.Controllers.Malwarebytes;

[Route("malwarebytes/users")]
public class MalwarebytesUserController : ApiController
{
    private readonly IMalwarebytesUserService _malwarebytesUserService;

    public MalwarebytesUserController(IMalwarebytesUserService malwarebytesUserService)
    {
        _malwarebytesUserService = malwarebytesUserService;
    }

    /// <summary>
    ///     Get all users from OneView
    /// </summary>
    /// <returns> list of <see cref="MbamOneViewUser" /> </returns>
    [HttpGet]
    [Authorize(Roles = "PlayAdmin")]
    public async Task<IActionResult> GetUsers()
    {
        try
        {
            var users = await _malwarebytesUserService.GetUsersAsync();
            return CustomResponse(users);
        }
        catch (Exception e)
        {
            AddError(e.Message);
            return CustomResponse();
        }
    }

    /// <summary>
    ///     Get total count of users from OneView
    /// </summary>
    [HttpGet("count")]
    [Authorize(Roles = "PlayAdmin")]
    public async Task<IActionResult> GetUsersCount()
    {
        try
        {
            var count = await _malwarebytesUserService.GetUsersCountAsync();
            return CustomResponse(new { count });
        }
        catch (Exception e)
        {
            AddError(e.Message);
            return CustomResponse();
        }
    }
}